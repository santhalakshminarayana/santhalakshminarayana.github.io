<!DOCTYPE html><html lang="en"><head><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Maven+Pro&amp;family=Share+Tech+Mono&amp;family=Source+Sans+Pro&amp;family=Ubuntu&amp;display=swap" data-optimized-fonts="true"/><meta charSet="utf-8" class="jsx-1085971570"/><meta name="viewport" content="width=device-width, initial-scale=1" class="jsx-1085971570"/><meta name="description" content="Make computations in Python faster with Multi-processing ." class="jsx-1085971570"/><meta name="author" content="Santha Lakshmi Narayana" class="jsx-1085971570"/><meta name="keywords" content="python-multiprocessing,python-performance,python-optimize,python,fast-python,speed" class="jsx-1085971570"/><meta property="og:title" content="Super fast Python (Part-3): Multi-processing- Santha Lakshmi Narayana" class="jsx-1085971570"/><meta property="og:description" content="Make computations in Python faster with Multi-processing ." class="jsx-1085971570"/><meta property="og:url" content="https://santhalakshminarayana.github.io/blog/super-fast-python-multi-processing" class="jsx-1085971570"/><meta property="og:image" content="https://santhalakshminarayana.github.io/images/super-fast-python-multi-processing/super-fast-python-multi-processing.jpg" class="jsx-1085971570"/><meta property="og:type" content="article" class="jsx-1085971570"/><meta property="og:article:publisher" content="https://santhalakshminarayana.github.io/" class="jsx-1085971570"/><meta property="og:site_name" content="Santha Lakshmi Narayana" class="jsx-1085971570"/><meta name="twitter:card" content="summary_large_image" class="jsx-1085971570"/><meta name="twitter:title" content="Super fast Python (Part-3): Multi-processing- Santha Lakshmi Narayana" class="jsx-1085971570"/><meta name="twitter:description" content="Make computations in Python faster with Multi-processing ." class="jsx-1085971570"/><meta name="twitter:url" content="https://santhalakshminarayana.github.io/blog/super-fast-python-multi-processing" class="jsx-1085971570"/><meta name="twitter:site" content="@santhalakshminarayana" class="jsx-1085971570"/><meta name="twitter:image" content="https://santhalakshminarayana.github.io/images/super-fast-python-multi-processing/super-fast-python-multi-processing.jpg" class="jsx-1085971570"/><meta name="twitter:creator" content="@santhalakshminarayana" class="jsx-1085971570"/><link rel="icon" href="/images/santha-lakshmi-narayana-logo.png?" class="jsx-1085971570"/><link rel="canonical" href="https://santhalakshminarayana.github.io/blog/super-fast-python-multi-processing" class="jsx-1085971570"/><title class="jsx-1085971570">Super fast Python (Part-3): Multi-processing- Santha Lakshmi Narayana</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous" class="jsx-1085971570"/><meta name="next-head-count" content="24"/><link rel="preload" href="/_next/static/css/33042267ec80af6a9a8e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/33042267ec80af6a9a8e.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-2b6f4fb4c650415a78b4.js" defer=""></script><script src="/_next/static/chunks/framework.1b3b121feae4c8ce410b.js" defer=""></script><script src="/_next/static/chunks/commons.5b2d72a8e34e4f7cda46.js" defer=""></script><script src="/_next/static/chunks/main-d372fe187139d1f38e70.js" defer=""></script><script src="/_next/static/chunks/pages/_app-83b3864244b0f97c080a.js" defer=""></script><script src="/_next/static/chunks/d0447323.b45849b482775ab7aa09.js" defer=""></script><script src="/_next/static/chunks/773f402080c38a523cb0b4f52dac49b5097e45fc.11fc351dfcb5de711ab5.js" defer=""></script><script src="/_next/static/chunks/6188d020c9511bd1e7ae4c1c2034aa4e99a1704e.c23b016970488f69b86e.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-97fdcc53a45008647083.js" defer=""></script><script src="/_next/static/9jpMCygIQS262thMs5TvH/_buildManifest.js" defer=""></script><script src="/_next/static/9jpMCygIQS262thMs5TvH/_ssgManifest.js" defer=""></script><style id="__jsx-3242260268">.tags.jsx-3242260268{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:1vw 5vw 1vw 5vw;background-color:#fffecb;border-bottom:5px solid #071013;}.tags.jsx-3242260268 a.jsx-3242260268{font-family:"Share Tech Mono",monospace;color:#1d2b35;margin:0 1em 0 1em;-webkit-text-decoration:none;text-decoration:none;border-bottom:1px dashed #fb232e;}.tags.jsx-3242260268 a.jsx-3242260268:hover{background:#20a4f3;color:#fffecb;border-bottom:1px dashed #fffecb;}.tags.jsx-3242260268 a.jsx-3242260268:active{background:#fb232e;}</style><style id="__jsx-90057834">.header-container.jsx-90057834{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;padding:10px 5vw 10px 5vw;background:#1d2b35;}.header-left.jsx-90057834{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.header-left.jsx-90057834 a.jsx-90057834{font-family:"Source Sans Pro",sans-serif;-webkit-text-decoration:none;text-decoration:none;color:#ffaa33;}img.jsx-90057834{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;width:calc(1.2rem + 1vw);max-width:calc(1.2rem + 1vw);height:auto;margin:0 5px 0 5px;}img.jsx-90057834:hover{cursor:pointer;}.header-left.jsx-90057834 a.jsx-90057834:hover{color:#20a4f3;}.header-left.jsx-90057834 a.jsx-90057834:active{color:#fb232e;}.header-right.jsx-90057834{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:3;-ms-flex:3;flex:3;-webkit-flex-direction:row-reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.header-right.jsx-90057834 a.jsx-90057834{padding:0 1vw 0 1vw;font-family:"Source Sans Pro",sans-serif;-webkit-text-decoration:none;text-decoration:none;color:#ffaa33;}.header-right.jsx-90057834 a.jsx-90057834:hover{color:#20a4f3;}.header-right.jsx-90057834 a.jsx-90057834:active{color:#fb232e;}@media screen and (max-width:920px){.header-container.jsx-90057834{padding:10px 2vw 10px 2vw;}#name.jsx-90057834{display:none;}img.jsx-90057834{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media screen and (max-width:480px){.header-container.jsx-90057834{padding:10px 2vw 10px 2vw;overflow-x:scroll;}}@media screen and (max-width:300px){img.jsx-90057834{display:none;}}</style><style id="__jsx-2944168904">.img-text.jsx-2944168904{display:block;text-align:center;font-family:"Source Sans Pro",sans-serif;font-size:calc(0.8rem + 0.1vw);color:#1d2b35;overflow-wrap:"break-word";}a.jsx-2944168904{margin:0;-webkit-text-decoration:none;text-decoration:none;color:#1d2b35;border-bottom:1px solid;}</style><style id="__jsx-1110062031">.file-name-container.jsx-1110062031{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;max-width:100%;background-color:#1d2b35d9;padding:calc(0.5rem + 0.2vw);border-top-left-radius:5px;border-top-right-radius:5px;margin-top:1vh;white-space:pre-wrap;word-wrap:break-word;overflow-wrap:break-word;}.file-name.jsx-1110062031{font-family:"Share Tech Mono",monospace;font-size:calc(0.9rem + 0.1vw);color:#fffecbf2;}</style><style id="__jsx-1393389675">.footer-container.jsx-1393389675{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background:#1d2b35e6;padding:1vw 1vw 1vw 1vw;}.footer-container-links.jsx-1393389675{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}.footer-links.jsx-1393389675{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.link-item.jsx-1393389675{margin:0 1vw 0 1vw;}.link.jsx-1393389675{-webkit-text-decoration:none;text-decoration:none;cursor:pointer: background-color:yellow;}.link.jsx-1393389675:hover{color:black;}.copy-right-container.jsx-1393389675{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-top:10px;}.copy-right-text.jsx-1393389675{font-family:'Maven Pro',sans-serif;font-size:calc(0.75rem + 0.1vw);color:#fffecb;}</style><style id="__jsx-1085971570">.blog-content.jsx-1085971570{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:100%;-ms-flex:100%;flex:100%;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;margin:1vw 25vw 1vw 25vw;width:50vw;max-width:50vw;min-height:90vh;}@media screen and (max-width:980px){.blog-content.jsx-1085971570{margin:1vw 15vw 1vw 15vw;width:70vw;max-width:70vw;}}@media screen and (max-width:760px){.blog-content.jsx-1085971570{margin:1vw 5vw 1vw 5vw;width:90vw;max-width:90vw;}}</style><style data-href="https://fonts.googleapis.com/css2?family=Maven+Pro&family=Share+Tech+Mono&family=Source+Sans+Pro&family=Ubuntu&display=swap">@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v39/7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8SX25nM.woff) format('woff')}@font-face{font-family:'Share Tech Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sharetechmono/v15/J7aHnp1uDWRBEqV98dVQztYldFc7pw.woff) format('woff')}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3aPA.woff) format('woff')}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v20/4iCs6KVjbNBYlgo6ew.woff) format('woff')}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v39/7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8SX21nijpBh8CvRBOB1s.woff) format('woff');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v39/7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8SX21nmjpBh8CvRBOB1s.woff) format('woff');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Maven Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/mavenpro/v39/7Auup_AqnyWWAxW2Wk3swUz56MS91Eww8SX21nejpBh8CvRBOA.woff) format('woff');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Share Tech Mono';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sharetechmono/v15/J7aHnp1uDWRBEqV98dVQztYldFcLowEFA87Heg.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNa7lujVj9_mf.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qPK7lujVj9_mf.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNK7lujVj9_mf.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qO67lujVj9_mf.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qN67lujVj9_mf.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lujVj9_mf.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Source Sans Pro';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/sourcesanspro/v22/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v20/4iCs6KVjbNBYlgoKcg72nU6AF7xm.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v20/4iCs6KVjbNBYlgoKew72nU6AF7xm.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v20/4iCs6KVjbNBYlgoKcw72nU6AF7xm.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v20/4iCs6KVjbNBYlgoKfA72nU6AF7xm.woff2) format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v20/4iCs6KVjbNBYlgoKcQ72nU6AF7xm.woff2) format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Ubuntu';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/ubuntu/v20/4iCs6KVjbNBYlgoKfw72nU6AFw.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><div style="min-height:100vh" class="jsx-1085971570"><div class="jsx-90057834 header"><div class="jsx-90057834 header-container"><div class="jsx-90057834 header-left"><img src="/images/santha-lakshmi-narayana-logo.png" alt="Logo" class="jsx-90057834"/><a id="name" class="jsx-90057834" href="/"><b class="jsx-90057834">Santha Lakshmi Narayana</b></a></div><div class="jsx-90057834 header-right"><a class="jsx-90057834" href="/about">About</a><a href="#" class="jsx-90057834">Tags</a><a class="jsx-90057834" href="/">Home</a></div></div><div style="display:none" class="jsx-90057834"><div class="jsx-3242260268 tags"><a class="jsx-3242260268" href="/tags/ai">#ai</a><a class="jsx-3242260268" href="/tags/system-design">#system-design</a><a class="jsx-3242260268" href="/tags/python">#python</a><a class="jsx-3242260268" href="/tags/python-performance">#python-performance</a><a class="jsx-3242260268" href="/tags/go">#go</a><a class="jsx-3242260268" href="/tags/linux">#linux</a><a class="jsx-3242260268" href="/tags/mysql">#mysql</a><a class="jsx-3242260268" href="/tags/image-processing">#image-processing</a><a class="jsx-3242260268" href="/tags/opencv">#opencv</a><a class="jsx-3242260268" href="/tags/concurrency">#concurrency</a><a class="jsx-3242260268" href="/tags/color-science">#color-science</a><a class="jsx-3242260268" href="/tags/react">#react</a><a class="jsx-3242260268" href="/tags/next-js">#next-js</a><a class="jsx-3242260268" href="/tags/flutter">#flutter</a></div></div></div><article class="jsx-1085971570 blog-content"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><picture class="jsx-2944168904"><img src="/images/super-fast-python-multi-processing/super-fast-python-multi-processing.jpg" alt="Super fast Python: Multi-processing" style="width:100%;max-width:100%;height:auto;margin-left:0%" class="jsx-2944168904"/><span class="jsx-2944168904 img-text"></span></picture></p><h6 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#fb232e;margin:1vh 0 1vh 0;overflow-wrap:break-word">Published on: <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Nov 12, 2022</strong></h6><h1 style="font-family:&#x27;Ubuntu&#x27;, sans-serif;font-size:calc(1rem + 1.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Super fast Python (Part-3): Multi-processing</h1><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">This is the third post in the series on Python performance and Optimization. The series points out the utilization of inbuilt libraries, low-level code conversions, and other Python implementations to speed-up Python. The other posts included in this series are</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li>(Part-1): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow">Why Python is slow?</a></li><li>(Part-2): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-good-practices">Good practices to write fast Python code</a></li><li>(Part-3): Multi-processing in Python (this post)</li><li>(Part-4): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-cython">Use Cython to get speed as fast as C</a></li><li>(Part-5): <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-numba">Use Numba to speed up Python Functions and Numeric calculations</a></li></ul><h2 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 1vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Problems with GIL</h2><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In the previous post on <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow">why python is slow?</a>, we discussed that the problems with <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow#gil-good-and-bad">Global Interpreter Lock (GIL) in Python</a>. <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://realpython.com/python-gil/">GIL</a> is part of Python&#x27;s design that ensures thread-safe in Python. But, GIL only allows the interpreter to run with only one thread which makes multi-threading hard and slow in Python.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">This makes multi-threading confined to use in cases like where <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://tenthousandmeters.com/blog/python-behind-the-scenes-13-the-gil-and-its-effects-on-python-multithreading/">system releases the GIL</a> for tasks where it waits for external processes to complete and return result/status like I/O operations, network requests, etc. To achieve better concurrency in Python, use <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/asyncio-task.html">coroutines with asyncio</a>.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">So, even if the system has multiple cores and supports 1000s of threads, multi-threading is not suitable for CPU-intensive tasks. But, how to do <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://hpc.llnl.gov/documentation/tutorials/introduction-parallel-computing-tutorial">parallel computing</a> in Python? The answer is Multi-programming. Multi-programming creates multiple sub-processes (maximum processes can be created = no.of cores) where each process will have its interpreter with GIL and independent memory space. In processes, GIL won&#x27;t be a problem because each one will have its interpreter to run the bytecode and the CPython manages multiple sub-processes. But, there are some overheads with processes like spawning/forking a process with its own memory space is slower than creating a thread and each process is separate which makes inter-process communication slow.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Also, there are external libraries like Numpy that release GIL and compute the tasks faster. <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://iotespresso.com/numpy-releases-gil-what-does-that-mean/">Numpy releases GIL</a> - means most of the Numpy computations are executed in C-libraries that don&#x27;t require an interpreter which makes Numpy can release the GIL for that particular C-library.</p><hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/multiprocessing.html">multiprocessing</a> module in Python offers a variety of APIs for achieving multiprocessing. In this blog, we discuss <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool">mulitprocessing.Pool</a> class that takes multiple numbers of tasks and executes them parallelly by distributing tasks among multiple cores/workers.</p><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor">concurrent.futures.ProcessPoolExecutor</a> provides a higher level interface on top of <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing</strong> and offers additonal functions to control the process pool.</p></blockquote><h2 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 1vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Multiprocessing Pool</h2><h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Why and what is a pool?</h3><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Imagine we have an 8-cores CPU and create a process by allocating each process to each core for every task and executing them parallelly. If no.of tasks is &lt;= no.of cores, then the parallel computing works smoothly. If we increase the no.of tasks to let&#x27;s say 100 and create a process for each task and then execute them parallelly, the system has to manage the lifecycle of each process and ensure that processes don&#x27;t hang up or reach a deadlock state. If we have numerous processes that the system can&#x27;t handle we run into problems like system crash or hang.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">A pool is like a strategy in parallel computing to make sure that only a certain number of workers (or cores in the CPU) are allocated to run tasks given in any number. A pool is really helpful to prevent the system from the crash while serving a very huge number of processes that may overkill the CPU if not properly managed. We create a maximum of n-workers for a system with n-cores and distribute the task to every worker to run parallelly. The main difference is that in normal execution, for every task we create a separate process, but in pool processing, first, we create a pool of processes, then distribute the tasks among the processes in the pool.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">If we have 100 tasks and a pool with 5 processes, distribute the 100 tasks to the process pool by running a batch of 20 tasks per process.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Consider a function that takes around <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">1-second</strong> to complete. And we have to call the function for 10 different input parameters.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The following example shows <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">fun_1()</strong> as a function that takes a parameter <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong>, sleeps for 1 second, and then returns the square of <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong>.</p><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Why prefer <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://peps.python.org/pep-0418/">time.perf_counter()</a> over time.time()? time.time() is not monotonic - which means that the system can change the clock time with synchronization to the internet or other update. Where time.perf_counter() is system-wide and the reference point is unknown so only the results between consecutive calls are considered.</p></blockquote><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Now, call the function 10 times by passing the elements in the range(0..10). If we call the function without parallel processing, the total time will be around 10 seconds because every function call takes 1 second, and for 10 function calls it will be around 10 seconds.</p><pre><pre class="language-python" style="color:#d4d4d4;font-size:calc(0.9rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-top:1vh;margin-bottom:1vh;border-radius:5px"><code class="language-python" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span class="token" style="color:#569CD6">from</span><span> os </span><span class="token" style="color:#569CD6">import</span><span> getpid
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span><span></span><span class="token" style="color:#569CD6">from</span><span> time </span><span class="token" style="color:#569CD6">import</span><span> perf_counter</span><span class="token" style="color:#d4d4d4">,</span><span> sleep
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span><span></span><span class="token" style="color:#569CD6">from</span><span> multiprocessing </span><span class="token" style="color:#569CD6">import</span><span> Pool</span><span class="token" style="color:#d4d4d4">,</span><span> cpu_count
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span><span></span><span class="token" style="color:#6a9955"># function that sleeps for 1 second</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span><span></span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">fun_1</span><span class="token" style="color:#d4d4d4">(</span><span>a</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span><span>    </span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;WORKER ID:&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span> getpid</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span><span>    sleep</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">1</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span><span>    </span><span class="token" style="color:#569CD6">return</span><span> a </span><span class="token" style="color:#d4d4d4">*</span><span> a
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span><span></span><span class="token" style="color:#6a9955"># call fun_1 for elements in range(0..10)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">13</span><span></span><span class="token" style="color:#6a9955"># without multiprocessing</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">14</span><span>atime </span><span class="token" style="color:#d4d4d4">=</span><span> perf_counter</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">15</span><span></span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;without multiprocessing&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">16</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">17</span><span>res </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span>fun_1</span><span class="token" style="color:#d4d4d4">(</span><span>i</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">for</span><span> i </span><span class="token" style="color:#569CD6">in</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">18</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">19</span><span></span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#ce9178">f&quot;time taken without multiprocessing: </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#9cdcfe">perf_counter</span><span class="token string-interpolation" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#d4d4d4">)</span><span class="token string-interpolation" style="color:#d4d4d4">-</span><span class="token string-interpolation" style="color:#9cdcfe">atime</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">\n&quot;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">20</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">21</span><span></span><span class="token" style="color:#6a9955"># with multiprocessing</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">22</span><span>atime </span><span class="token" style="color:#d4d4d4">=</span><span> perf_counter</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">23</span><span></span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;with multiprocessing&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">24</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">25</span><span></span><span class="token" style="color:#569CD6">with</span><span> Pool</span><span class="token" style="color:#d4d4d4">(</span><span>processes</span><span class="token" style="color:#d4d4d4">=</span><span>cpu_count</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">as</span><span> pool</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">26</span><span>    res </span><span class="token" style="color:#d4d4d4">=</span><span> pool</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#ce9178">map</span><span class="token" style="color:#d4d4d4">(</span><span>fun_1</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">27</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">28</span><span></span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#ce9178">f&quot;time taken with multiprocessing: </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#9cdcfe">perf_counter</span><span class="token string-interpolation" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#d4d4d4">)</span><span class="token string-interpolation" style="color:#d4d4d4">-</span><span class="token string-interpolation" style="color:#9cdcfe">atime</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">&quot;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">29</span></code></pre></pre><pre><div class="jsx-1110062031"><div class="jsx-1110062031 file-name-container"><p class="jsx-1110062031 file-name">output</p></div><pre class="language-markdown:output" style="color:#1d2b35;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0px;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-bottom:1vh;border-bottom-left-radius:5px;border-bottom-right-radius:5px"><code class="language-markdown" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span>without multiprocessing
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span>WORKER ID: 32093
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span>time taken without multiprocessing: 10.019481873001496
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">13</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">14</span>with multiprocessing
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">15</span>WORKER ID: 33097
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">16</span>WORKER ID: 33099
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">17</span>WORKER ID: 33098
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">18</span>WORKER ID: 33100
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">19</span>WORKER ID: 33101
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">20</span>WORKER ID: 33103
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">21</span>WORKER ID: 33102
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">22</span>WORKER ID: 33096
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">23</span>WORKER ID: 33098
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">24</span>WORKER ID: 33101
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">25</span>time taken with multiprocessing: 2.077159455002402
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">26</span></code></pre></div></pre><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In the above code, we applied parallel computing by passing tasks (calling <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">fun<!-- -->_<!-- -->()</strong>) to the multiprocessing pool.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The pool class constructor takes the following arguments and returns the pool object</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">processes</strong>: no.of workers, default is all cores available in the system. We can check the available cores by calling <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">multiprocessing.cpu_count()</em> (mine is 8)</li><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">initializer</strong>: initializer function that will be called by every worker when it starts</li><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">initargs</strong>: arguments to the initializer function above</li><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">maxtasksperchild</strong>: max. no.of tasks a worker should execute before being replaced by another worker process. This behavior releases the workers that are using system resources for a very long time</li></ul><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">We discuss <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">initializer</strong> and <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">initargs</strong> in the later section on sharing data between processes.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The pool object has several methods like apply, map, starmap, imap, etc, that serves different purpose for applying parallel computing. In the above snippet, we used Pool.map() function (same as normal map()) that takes a function and an iterable and calls the function by passing each element in the iterable as an argument. The function should accept only an argument. The Pool.map() is a blocking call and it distributes the tasks among the available cores by dividing the tasks into chunks.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Pool.map() takes the following arguments</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">func</strong>: the function to be executed parallelly that takes one argument</li><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">iterable</strong>: an iterable whose elements are passed as arguments to the function above</li><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">chunksize</strong>: chunk size number that used to divide the tasks</li></ul><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">based on the nature of tasks, different <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">chunksize</strong> numbers <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://stackoverflow.com/questions/53751050/multiprocessing-understanding-logic-behind-chunksize">schedules tasks differently</a></p></blockquote><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In UNIX and such systems, <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/multiprocessing.html#contexts-and-start-methods">multiprocessing creates processes</a> using a fork, and in windows, it starts processes using spawn. There are some <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/multiprocessing.html#contexts-and-start-methods">additional restrictions</a> one should be aware of when the process start method is other than fork like protecting the entry point of the program by creating processes inside _if <!-- -->_<!-- -->_<!-- -->name<!-- -->_<!-- -->_<!-- -->==<!-- -->_<!-- -->_<!-- -->main<!-- -->_<!-- -->_<!-- -->_ because spawn creates new python interpreter for each process.</p></blockquote><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">As we have 8 cores available and 10 tasks at hand, Pool.map() distributes the tasks among the 8 workers by dividing tasks into chunks like <!-- -->[2, 2, 1, 1, 1, 1, 1, 1]<!-- --> and pass them to workers.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The total time taken with multiprocessing is 2 seconds which is 5x times faster than without multiprocessing (10 seconds).</p><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">for large iterable size use Pool.imap() with chunksize for better efficiency</p></blockquote><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">for multiple parameters function, use Pool.starmap() or Pool.map() with partial functions</p></blockquote><h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Process vs Pool</h3><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Use process, when there is a small number of tasks and each task takes a large amount of time. Use a pool, when there is a large number of tasks and each task takes a small amount of time.</p><hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/><h2 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 1vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Sharing data between processes</h2><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">It is strongly recommended to not share data between processes</p></blockquote><h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Share data with global variables (copy-on-write)</h3><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Processes created using multiprocessing run independently with their own memory space and they don&#x27;t have access to the parent process&#x27;s local data but they <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://superfastpython.com/multiprocessing-inherit-global-variables-in-python/">inherit the global data of the parent</a> (only when fork start method used).</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Since child processes get a snapshot of the parent process&#x27;s global data, we can utilize this behavior in a way such that we can make sharable data available to child processes by making the data global.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">For the following example, we will share an integer value <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">x</strong> and an array of integers <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong> to calculate the sum of the product of each element in <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong> with an element in the list of numbers from 0..n, n = 100000. And then compute the product of <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">x</strong> and the whole sum.</p><pre><pre class="language-python" style="color:#d4d4d4;font-size:calc(0.9rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-top:1vh;margin-bottom:1vh;border-radius:5px"><code class="language-python" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span class="token" style="color:#6a9955"># function to be applied for each element</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span><span></span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">sum_product</span><span class="token" style="color:#d4d4d4">(</span><span>e</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span><span>    w_sum </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#ce9178">sum</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">[</span><span>x</span><span class="token" style="color:#d4d4d4">*</span><span>i </span><span class="token" style="color:#569CD6">for</span><span> i </span><span class="token" style="color:#569CD6">in</span><span> a</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span><span>    </span><span class="token" style="color:#569CD6">return</span><span> w_sum </span><span class="token" style="color:#d4d4d4">*</span><span> e
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span><span></span><span class="token" style="color:#6a9955"># pool initializer function</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span><span></span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">pool_initializer</span><span class="token" style="color:#d4d4d4">(</span><span>X</span><span class="token" style="color:#d4d4d4">,</span><span> A</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span><span>    </span><span class="token" style="color:#569CD6">global</span><span> x
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span><span>    x </span><span class="token" style="color:#d4d4d4">=</span><span> X
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span><span>    </span><span class="token" style="color:#569CD6">global</span><span> a
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span><span>    a </span><span class="token" style="color:#d4d4d4">=</span><span> A
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">13</span><span>n </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">100000</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">14</span><span>X </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">3</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">15</span><span>A </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#b5cea8">2</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">4</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">6</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">8</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">12</span><span class="token" style="color:#d4d4d4">]</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">16</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">17</span><span></span><span class="token" style="color:#569CD6">with</span><span> Pool</span><span class="token" style="color:#d4d4d4">(</span><span>processes</span><span class="token" style="color:#d4d4d4">=</span><span>cpu_count</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span> initializer</span><span class="token" style="color:#d4d4d4">=</span><span>pool_initializer</span><span class="token" style="color:#d4d4d4">,</span><span> initargs</span><span class="token" style="color:#d4d4d4">=</span><span class="token" style="color:#d4d4d4">(</span><span>X</span><span class="token" style="color:#d4d4d4">,</span><span> A</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">as</span><span> pool</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">18</span><span>    res </span><span class="token" style="color:#d4d4d4">=</span><span> pool</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#ce9178">map</span><span class="token" style="color:#d4d4d4">(</span><span>sum_product</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span>n</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">19</span></code></pre></pre><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In the above snippet, we initialized the pool with the <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">pool_initializer</em> function, this function will be called for every worker after they start and any data globalized inside this initialization function is available to all child processes.</p><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Even though we don&#x27;t need the initializer function here to share data as we can make data global at the top level and all child processes would get a snapshot of the global data, there are other cases where the initializer function is useful. Like reading a file and sharing data, making a database connection, etc, which might work on variable parameters that we can pass in pool <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">initargs</strong>.</p></blockquote><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Sharing data by leveraging global variables and copy-on-write data is only useful for read-only data. If any child process changes the global variable value, they don&#x27;t reflect in the parent process.</p><pre><pre class="language-python" style="color:#d4d4d4;font-size:calc(0.9rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-top:1vh;margin-bottom:1vh;border-radius:5px"><code class="language-python" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span class="token" style="color:#569CD6">from</span><span> random </span><span class="token" style="color:#569CD6">import</span><span> randint
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span><span></span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">random_increment</span><span class="token" style="color:#d4d4d4">(</span><span>i</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span><span>    rand_n </span><span class="token" style="color:#d4d4d4">=</span><span> randint</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span> i</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span><span>    a</span><span class="token" style="color:#d4d4d4">[</span><span>rand_n</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">+=</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span><span>    </span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#ce9178">f&#x27;child </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#9cdcfe">i</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">: </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#9cdcfe">a</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span><span>n </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">10</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span><span>a </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#ce9178">list</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span>n</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span><span></span><span class="token" style="color:#569CD6">with</span><span> Pool</span><span class="token" style="color:#d4d4d4">(</span><span>processes</span><span class="token" style="color:#d4d4d4">=</span><span>cpu_count</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">as</span><span> pool</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span><span>    pool</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#ce9178">map</span><span class="token" style="color:#d4d4d4">(</span><span>random_increment</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span>n</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">13</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">14</span><span></span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#ce9178">f&#x27;parent </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#9cdcfe">a</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">15</span></code></pre></pre><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In the above program, we have initialized a global variable <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong> which is a list. We applied the function <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">random_increment()</em> for <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">n</strong> tasks, and, <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">random_increment()</em> function takes the number <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">i</strong> and increments the list <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong> at the index generated randomly in the range(0..i).</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">As <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong> is global, we expect the list <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong> change in the parent process too, but it is not true as each child process is created by copying a snapshot of the parent data and each child will have their own memory.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Look at the output of the above program below to check that, in the parent process, the value of <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">a</strong> has not changed.</p><pre><div class="jsx-1110062031"><div class="jsx-1110062031 file-name-container"><p class="jsx-1110062031 file-name">Output</p></div><pre class="language-markdown:Output" style="color:#1d2b35;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0px;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-bottom:1vh;border-bottom-left-radius:5px;border-bottom-right-radius:5px"><code class="language-markdown" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span>child 2: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span>child 1: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span>child 3: [0, 2, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span>child 8: [1, 1, 3, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span>child 7: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span>child 6: [0, 1, 2, 3, 5, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span>child 0: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span>child 4: [0, 2, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span>child 9: [1, 2, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span>child 5: [0, 1, 2, 4, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span>parent [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span></code></pre></div></pre><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">This is because, the data sharing happens here by following a mechanism called <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">copy-on-write</strong> where the OS instead of copying and creating the new memory for the global data, just facilitates access to the parent processes memory as long as the child process doesn&#x27;t change the data. As we have seen in the above example, when the child process tries to change the data, OS just allocates the new memory by copying the shared data and then writes the changes to it. So, the child&#x27;s process data changes are not reflected in the parent&#x27;s process because both memory locations are different. This mechanism is vice-versa means that, after forking, when the data in the parent&#x27;s process changes, they are not reflected in the child&#x27;s process.</p><h3 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 0.5vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Share data using shared memory</h3><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">To avoid the problems like above, <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing</strong> provides a mechanism to share data. To share the data between child processes, one must use sockets or shared files. But, to share simple values or arrays, multiprocessing provides a mechanism called <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">shared ctypes</strong> to share data safely between processes.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">With <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/multiprocessing.html#module-multiprocessing.sharedctypes">multiprocessing.sharedctypes</a>, we can allocate the <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">ctypes</strong> object from the shared memory and then the child processes can inherit them. <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/ctypes.html#fundamental-data-types">cytpes</a> are nothing but primitive <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">C</strong> compatible data types and <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">ctypes</strong> module provides a wrapper around these data types to use in Python. The shared memory here is nothing but the underlying memory buffer and we will discuss later how can utilize this fact to share large Numpy arrays.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Multiprocessing provides two types of shared ctypes, one for read-and-write values and arrays, and the other one for read-only values and arrays.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">To manipulate data in child processes, use</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing.Value</strong>: to share only single value variables such as numbers or strings</li><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing.Array</strong>: to share an array of values of the same data type in <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">C</strong></li></ul><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">To share read-only data, use</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing.RawValue</strong>: to share only single value variables</li><li><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing.RawArray</strong>: to share array of values</li></ul><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The main difference between raw type and normal type is that the latter provides an automatic synchronization mechanism with locks to provide process-safe data sharing.</p><pre><pre class="language-python" style="color:#d4d4d4;font-size:calc(0.9rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-top:1vh;margin-bottom:1vh;border-radius:5px"><code class="language-python" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span class="token" style="color:#569CD6">from</span><span> multiprocessing </span><span class="token" style="color:#569CD6">import</span><span> Array
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span><span></span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">random_increment</span><span class="token" style="color:#d4d4d4">(</span><span>i</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span><span>    rand_n </span><span class="token" style="color:#d4d4d4">=</span><span> randint</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">,</span><span> i</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span><span>    a</span><span class="token" style="color:#d4d4d4">[</span><span>rand_n</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">+=</span><span> </span><span class="token" style="color:#b5cea8">1</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span><span>    </span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#ce9178">f&#x27;child </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#9cdcfe">i</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">: </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#ce9178">list</span><span class="token string-interpolation" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#9cdcfe">a</span><span class="token string-interpolation" style="color:#d4d4d4">)</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span><span></span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">initializer_func</span><span class="token" style="color:#d4d4d4">(</span><span>A</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span><span>    </span><span class="token" style="color:#569CD6">global</span><span> a
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span><span>    a </span><span class="token" style="color:#d4d4d4">=</span><span> A
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">13</span><span>n </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#b5cea8">10</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">14</span><span>A </span><span class="token" style="color:#d4d4d4">=</span><span> Array</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;i&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span>n</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">15</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">16</span><span></span><span class="token" style="color:#569CD6">with</span><span> Pool</span><span class="token" style="color:#d4d4d4">(</span><span>processes</span><span class="token" style="color:#d4d4d4">=</span><span>cpu_count</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span> initializer</span><span class="token" style="color:#d4d4d4">=</span><span>initializer_func</span><span class="token" style="color:#d4d4d4">,</span><span> initargs</span><span class="token" style="color:#d4d4d4">=</span><span class="token" style="color:#d4d4d4">(</span><span>A</span><span class="token" style="color:#d4d4d4">,</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">as</span><span> pool</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">17</span><span>    pool</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#ce9178">map</span><span class="token" style="color:#d4d4d4">(</span><span>random_increment</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span>n</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">18</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">19</span><span></span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#ce9178">f&#x27;parent: </span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#ce9178">list</span><span class="token string-interpolation" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#9cdcfe">A</span><span class="token string-interpolation" style="color:#d4d4d4">)</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">20</span></code></pre></pre><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In the above code, we have passed <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing.Array</strong> instead of the normal list. <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Array</strong> is initialized with the data type (&#x27;i&#x27;) and the iterable. We can also initialize the <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Array</strong> in other ways like defining the size first and assign later.</p><pre><pre class="language-python" style="color:#d4d4d4;font-size:calc(0.9rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-top:1vh;margin-bottom:1vh;border-radius:5px"><code class="language-python" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span>A </span><span class="token" style="color:#d4d4d4">=</span><span> Array</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;i&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span><span>A </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">10</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:2.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span></code></pre></pre><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">With <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Array</strong>, we can now see that the global variable <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">A</strong> is updated and reflected in the parent process. Also with <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Array</strong>, we can get automatic synchronization with locks that manage by multiprocessing so that the shared data is process-safe and only one process can access the data.</p><pre><div class="jsx-1110062031"><div class="jsx-1110062031 file-name-container"><p class="jsx-1110062031 file-name">Output</p></div><pre class="language-markdown:Output" style="color:#1d2b35;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0px;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-bottom:1vh;border-bottom-left-radius:5px;border-bottom-right-radius:5px"><code class="language-markdown" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span>child 3: [2, 1, 3, 4, 4, 5, 6, 7, 8, 9]
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span>child 7: [2, 1, 3, 5, 5, 7, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span>child 5: [2, 1, 3, 5, 5, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span>child 2: [2, 1, 3, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span>child 0: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span>child 1: [2, 1, 2, 3, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span>child 4: [2, 1, 3, 5, 4, 5, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span>child 8: [2, 1, 3, 5, 5, 8, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span>child 9: [2, 1, 3, 5, 5, 8, 6, 8, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span>child 6: [2, 1, 3, 5, 5, 6, 6, 7, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span>parent: [2, 1, 3, 5, 5, 8, 6, 8, 8, 9]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span></code></pre></div></pre><hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/><h2 style="font-family:&#x27;Maven Pro&#x27;, sans-serif;font-size:calc(1rem + 1vw);color:#1d2b35;margin:1vh 0 1vh 0;overflow-wrap:break-word" id="">Share large Numpy arrays between child processes</h2><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">For each task, as we pass data as arguments to the processes, the data will be pickled so that it can be sent from one process to other. If we pass large amounts of data, pickling involves a huge amount of memory and consumes more time. So, it is better to <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://research.wmz.ninja/articles/2018/03/on-sharing-large-arrays-when-using-pythons-multiprocessing.html">share large data between child processes</a> instead of passing the data individually.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">As we have seen in the above approach that copy-on-write sharing is good for read-only and to work with data that changes inside the child process, we have to share the data using a shared array. In this section, we will discuss sharing large Numpy arrays using a shared array.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">We know that shared arrays only support primitive <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">C</strong> data types and mainly 1D objects. But, how to share the Numpy arrays which are multidimensional in general to the child processes as shared ctypes do not directly support Numpy arrays? We can share Numpy arrays with some work around that is explained below.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">The shared ctypes objects we get are allocated from <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/c-api/buffer.html">buffer memory</a> memory. A <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="http://jakevdp.github.io/blog/2014/05/05/introduction-to-the-python-buffer-protocol/">buffer protocol</a> is a framework in Python designed to provide a mechanism for Python objects to share their data among objects. Any Python objects that are implemented in C-APIs can export a set of functions called the <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">buffer interface</strong>. With this buffer interface, <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://towardsdatascience.com/loading-binary-data-to-numpy-pandas-9caa03eb0672">any object can expose its data to other objects</a> directly without the need for copying.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">As shared ctypes objects are just wrappers around the C data types whose memory was allocated from buffer memory. This is the reason why the child process&#x27;s changes reflect in the parent process because the shared memory passed to child processes are implemented as <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/stdtypes.html#memoryview">memoryview</a> objects.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Consider the following example where we first create a large Numpy array of shape (1000, 1000), and using the process pool we assign the row number to every element in that row. As shared array doesn&#x27;t support multidimensional and custom data types, a common approach is to pass the Numpy array to every worker and assign the row with a row number. But, passing the large arrays between processes take huge memory and latency. So, we utilize the buffer protocol here. Since shared array objects are provided with a buffer interface, we can rely on this shared memory and make it global so that there is no need to pass Numpy arrays as arguments to each process.</p><pre><pre class="language-python" style="color:#d4d4d4;font-size:calc(0.9rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-top:1vh;margin-bottom:1vh;border-radius:5px"><code class="language-python" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">assign_int</span><span class="token" style="color:#d4d4d4">(</span><span>i</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span><span>    arr </span><span class="token" style="color:#d4d4d4">=</span><span> np</span><span class="token" style="color:#d4d4d4">.</span><span>frombuffer</span><span class="token" style="color:#d4d4d4">(</span><span>np_x</span><span class="token" style="color:#d4d4d4">.</span><span>get_obj</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span> dtype</span><span class="token" style="color:#d4d4d4">=</span><span>np</span><span class="token" style="color:#d4d4d4">.</span><span>int32</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span>reshape</span><span class="token" style="color:#d4d4d4">(</span><span>np_x_shape</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span><span>    arr</span><span class="token" style="color:#d4d4d4">[</span><span>i</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#d4d4d4">:</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">=</span><span> i
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span><span></span><span class="token" style="color:#569CD6">def</span><span> </span><span class="token" style="color:#dcdcaa">pool_initializer</span><span class="token" style="color:#d4d4d4">(</span><span>X</span><span class="token" style="color:#d4d4d4">,</span><span> X_shape</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span><span>    </span><span class="token" style="color:#569CD6">global</span><span> np_x
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span><span>    np_x </span><span class="token" style="color:#d4d4d4">=</span><span> X
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span><span>    </span><span class="token" style="color:#569CD6">global</span><span> np_x_shape
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span><span>    np_x_shape </span><span class="token" style="color:#d4d4d4">=</span><span> X_shape
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">10</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">11</span><span>X_shape </span><span class="token" style="color:#d4d4d4">=</span><span> </span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#b5cea8">1000</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#b5cea8">1000</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">12</span><span>data </span><span class="token" style="color:#d4d4d4">=</span><span> np</span><span class="token" style="color:#d4d4d4">.</span><span>zeros</span><span class="token" style="color:#d4d4d4">(</span><span>X_shape</span><span class="token" style="color:#d4d4d4">,</span><span> dtype</span><span class="token" style="color:#d4d4d4">=</span><span>np</span><span class="token" style="color:#d4d4d4">.</span><span>int32</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">13</span><span>X </span><span class="token" style="color:#d4d4d4">=</span><span> Array</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#ce9178">&#x27;i&#x27;</span><span class="token" style="color:#d4d4d4">,</span><span> X_shape</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">]</span><span> </span><span class="token" style="color:#d4d4d4">*</span><span> X_shape</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#b5cea8">1</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">14</span><span></span><span class="token" style="color:#6a9955"># X as a Numpy array</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">15</span><span>X_np </span><span class="token" style="color:#d4d4d4">=</span><span> np</span><span class="token" style="color:#d4d4d4">.</span><span>frombuffer</span><span class="token" style="color:#d4d4d4">(</span><span>X</span><span class="token" style="color:#d4d4d4">.</span><span>get_obj</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span> dtype</span><span class="token" style="color:#d4d4d4">=</span><span>np</span><span class="token" style="color:#d4d4d4">.</span><span>int32</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">.</span><span>reshape</span><span class="token" style="color:#d4d4d4">(</span><span>X_shape</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">16</span><span></span><span class="token" style="color:#6a9955"># copy data to the shared array</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">17</span><span>np</span><span class="token" style="color:#d4d4d4">.</span><span>copyto</span><span class="token" style="color:#d4d4d4">(</span><span>X_np</span><span class="token" style="color:#d4d4d4">,</span><span> data</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">18</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">19</span><span></span><span class="token" style="color:#569CD6">with</span><span> Pool</span><span class="token" style="color:#d4d4d4">(</span><span>processes</span><span class="token" style="color:#d4d4d4">=</span><span>cpu_count</span><span class="token" style="color:#d4d4d4">(</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">,</span><span> initializer</span><span class="token" style="color:#d4d4d4">=</span><span>pool_initializer</span><span class="token" style="color:#d4d4d4">,</span><span> initargs</span><span class="token" style="color:#d4d4d4">=</span><span class="token" style="color:#d4d4d4">(</span><span>X</span><span class="token" style="color:#d4d4d4">,</span><span> X_shape</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span> </span><span class="token" style="color:#569CD6">as</span><span> pool</span><span class="token" style="color:#d4d4d4">:</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">20</span><span>    pool</span><span class="token" style="color:#d4d4d4">.</span><span class="token" style="color:#ce9178">map</span><span class="token" style="color:#d4d4d4">(</span><span>assign_int</span><span class="token" style="color:#d4d4d4">,</span><span> </span><span class="token" style="color:#ce9178">range</span><span class="token" style="color:#d4d4d4">(</span><span>X_shape</span><span class="token" style="color:#d4d4d4">[</span><span class="token" style="color:#b5cea8">0</span><span class="token" style="color:#d4d4d4">]</span><span class="token" style="color:#d4d4d4">)</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">21</span>
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">22</span><span></span><span class="token" style="color:#569CD6">print</span><span class="token" style="color:#d4d4d4">(</span><span class="token string-interpolation" style="color:#ce9178">f&#x27;Numpy array X_np:\n</span><span class="token string-interpolation" style="color:#d4d4d4">{</span><span class="token string-interpolation" style="color:#9cdcfe">X_np</span><span class="token string-interpolation" style="color:#d4d4d4">}</span><span class="token string-interpolation" style="color:#ce9178">&#x27;</span><span class="token" style="color:#d4d4d4">)</span><span>
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:3.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">23</span></code></pre></pre><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">First, we defined the shape of the array <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">X_Shape</strong>, and then created a Numpy array with zeros of shape <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">X_Shape</strong>. Second, we have created a synchronized shared array and assigned it to <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">X</strong>. Third, we wrapped the shared array as Numpy using <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">np.frombuffer</strong>.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word"><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">np.frombuffer</strong> takes a 1-dimensional buffer array and interprets it into a Numpy array so we can manipulate the array easily. We used <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">X.get_obj()</em> instead <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">X</strong> because <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">X</strong> is a synchronized wrapper around the raw array and calling the <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">get_obj()</strong> returns the raw buffer object.</p><blockquote style="font-style:italic;background-color:#20a4f326;padding:10px;margin:1vh 0 1vh 0;border-left:5px solid #20a4f3e6"><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">For raw arrays (RawArray), objects should be passed normally without calling get_obj().</p></blockquote><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Why use <a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://www.educba.com/numpy-frombuffer/"><strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">np.frombuffer</strong></a>? Since Numpy arrays take a large amount of memory space, we don&#x27;t want to create a copy that again takes large memory. So, using <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">np.frombuffer</strong> by utilizing the buffer protocol, we can get a Numpy array which is just a wrapper around the buffer memory.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">initiargs</strong>, we should pass the shared array instead Numpy wrapper. We also pass the shape of the Numpy array as we need to reshape the 1D shared array into a multidimensional array in the worker function <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">assign_int()</em>.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In the worker function <em style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;background-color:#07101326;color:#071013f2;margin:0vh 0 1vh 0;padding:0 2px 0 2px;border-radius:2px">assign_int()</em>, again we interpreted the buffer as a Numpy array and assigned the row values at row number <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">i</strong>.</p><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">At last, in the parent process, we can check the multiprocessing assignment of the Numpy array.</p><pre><div class="jsx-1110062031"><div class="jsx-1110062031 file-name-container"><p class="jsx-1110062031 file-name">Output</p></div><pre class="language-markdown:Output" style="color:#1d2b35;font-size:13px;text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0px;overflow:auto;background:#1e1e1e;background-color:#071013f2;padding-bottom:1vh;margin-bottom:1vh;border-bottom-left-radius:5px;border-bottom-right-radius:5px"><code class="language-markdown" style="color:#d4d4d4;font-size:calc(0.8rem + 0.1vw);text-shadow:none;font-family:Menlo, Monaco, Consolas, &quot;Andale Mono&quot;, &quot;Ubuntu Mono&quot;, &quot;Courier New&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.2;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">1</span><span>Numpy array X_np:
</span><span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">2</span>[[  0   0   0 ...   0   0   0]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">3</span> [  1   1   1 ...   1   1   1]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">4</span> [  2   2   2 ...   2   2   2]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">5</span> ...
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">6</span> [997 997 997 ... 997 997 997]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">7</span> [998 998 998 ... 998 998 998]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">8</span> [999 999 999 ... 999 999 999]]
<span class="linenumber react-syntax-highlighter-line-number" style="display:inline-block;min-width:1.25em;padding-right:1em;text-align:right;user-select:none;color:#6a9955">9</span></code></pre></div></pre><hr style="margin:2vh 25% 2vh 25%;border:1px solid #07101380"/><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">Even though <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing</strong> looks easy and flexible to use, there are some issues one can face with <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing</strong> if not careful,</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://pythonspeed.com/articles/python-multiprocessing/">Why your multiprocessing Pool is stuck</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://superfastpython.com/multiprocessing-best-practices/">Multiprocessing Best Practices</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://sefiks.com/2021/07/05/handling-hang-in-python-multiprocessing/">Handling Hang in Python Multiprocessing</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://pythonspeed.com/articles/parallelism-slower/">The Parallelism Blues: when faster code is slower</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://www.cloudcity.io/blog/2019/02/27/things-i-wish-they-told-me-about-multiprocessing-in-python/">Things I Wish They Told Me About Multiprocessing in Python</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://towardsdatascience.com/exception-handling-in-methods-of-the-multiprocessing-pool-class-in-python-7fbb73746c26">Exception Handling in Methods of the Multiprocessing Pool Class in Python</a></li></ul><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">In this blog, we discussed Python&#x27;s <strong style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);font-style:normal;font-weight:bold;color:#1d2b35f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">multiprocessing</strong> module with the Pool function. Python released other modules for simple concurrent processing and better data sharing,</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/multiprocessing.html#managers">Managers</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/multiprocessing.shared_memory.html">Shared Memroy</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.python.org/3/library/concurrent.futures.html">Concurrent Futures</a></li></ul><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">On top of internal libraries, there are multiple good external libraries available for parallel and concurrent processing,</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://joblib.readthedocs.io/en/latest/parallel.html">Joblib</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://ipyparallel.readthedocs.io/en/latest/tutorial/intro.html">IPyParallel</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://docs.ray.io/en/master/index.html">Ray</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://www.dask.org/">Dask</a></li></ul><p style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013f2;margin:0vh 0 1vh 0;overflow-wrap:break-word">For comparison among internal and external libraries,</p><ul style="font-family:&#x27;Source Sans Pro&#x27;, sans-serif;font-size:calc(1rem + 0.1vw);color:#071013e6;margin:1vh 0 1vh calc(2vw);overflow-wrap:break-word"><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://www.anyscale.com/blog/parallelizing-python-code">Parallelizing Python Code</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://cosmiccoding.com.au/tutorials/multiprocessing">Multiprocessing In Python: Core vs libraries</a></li><li><a style="color:#071013;text-decoration:none;cursor:pointer;border-bottom:1px dashed #fb232e;font-size:calc(1rem + 0.1vw);font-weight:bold;overflow-wrap:break-word" target="_blank" rel="noreferrer" href="https://luis-sena.medium.com/sharing-big-numpy-arrays-across-python-processes-abf0dc2a0ab2">Sharing big NumPy arrays across python processes</a></li></ul></article><div class="jsx-1393389675 footer-container"><div class="jsx-1393389675 footer-container-links"><div class="jsx-1393389675 footer-links"><div class="jsx-1393389675 link-item"><a href="https://github.com/santhalakshminarayana" rel="noreferrer" target=" _blank" class="jsx-1393389675 link"><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" style="color:#fffecb;font-size:calc(0.8rem + 1vw)" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg></div></a></div><div class="jsx-1393389675 link-item"><a href="https://www.linkedin.com/in/santhalakshminarayana/" rel="noreferrer" target="_blank" class="jsx-1393389675 link"><div><svg stroke="currentColor" fill="currentColor" stroke-width="0" role="img" viewBox="0 0 24 24" style="color:#fffecb;font-size:calc(0.8rem + 1vw)" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><title></title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></div></a></div></div></div><div class="jsx-1393389675 copy-right-container"><p class="jsx-1393389675 copy-right-text">Santha Lakshmi Narayana  2025</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postMetadata":{"title":"Super fast Python (Part-3): Multi-processing","description":"Make computations in Python faster with Multi-processing .","imgName":"super-fast-python-multi-processing/super-fast-python-multi-processing.jpg","date":"Nov 12, 2022","tags":["python-performance","python"],"keywords":["python-multiprocessing","python-performance","python-optimize","python","fast-python","speed"],"id":"super-fast-python-multi-processing"},"postContent":{"compiledSource":"var c=Object.defineProperty,m=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var n=Object.getOwnPropertySymbols;var o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var p=(a,t,r)=\u003et in a?c(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,e=(a,t)=\u003e{for(var r in t||(t={}))o.call(t,r)\u0026\u0026p(a,r,t[r]);if(n)for(var r of n(t))i.call(t,r)\u0026\u0026p(a,r,t[r]);return a},l=(a,t)=\u003em(a,u(t));var h=(a,t)=\u003e{var r={};for(var s in a)o.call(a,s)\u0026\u0026t.indexOf(s)\u003c0\u0026\u0026(r[s]=a[s]);if(a!=null\u0026\u0026n)for(var s of n(a))t.indexOf(s)\u003c0\u0026\u0026i.call(a,s)\u0026\u0026(r[s]=a[s]);return r};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(r){var s=r,{components:a}=s,t=h(s,[\"components\"]);return mdx(MDXLayout,l(e(e({},layoutProps),t),{components:a,mdxType:\"MDXLayout\"}),mdx(\"p\",null,mdx(\"img\",e({parentName:\"p\"},{src:\"super-fast-python-multi-processing/super-fast-python-multi-processing.jpg\",alt:\"Super fast Python: Multi-processing\"}))),mdx(\"h6\",null,\"Published on: \",mdx(\"strong\",{parentName:\"h6\"},\"Nov 12, 2022\")),mdx(\"h1\",null,\"Super fast Python (Part-3): Multi-processing\"),mdx(\"p\",null,\"This is the third post in the series on Python performance and Optimization. The series points out the utilization of inbuilt libraries, low-level code conversions, and other Python implementations to speed-up Python. The other posts included in this series are\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},\"(Part-1): \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow\"}),\"Why Python is slow?\")),mdx(\"li\",{parentName:\"ul\"},\"(Part-2): \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://santhalakshminarayana.github.io/blog/super-fast-python-good-practices\"}),\"Good practices to write fast Python code\")),mdx(\"li\",{parentName:\"ul\"},\"(Part-3): Multi-processing in Python (this post)\"),mdx(\"li\",{parentName:\"ul\"},\"(Part-4): \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://santhalakshminarayana.github.io/blog/super-fast-python-cython\"}),\"Use Cython to get speed as fast as C\")),mdx(\"li\",{parentName:\"ul\"},\"(Part-5): \",mdx(\"a\",e({parentName:\"li\"},{href:\"https://santhalakshminarayana.github.io/blog/super-fast-python-numba\"}),\"Use Numba to speed up Python Functions and Numeric calculations\"))),mdx(\"h2\",null,\"Problems with GIL\"),mdx(\"p\",null,\"In the previous post on \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow\"}),\"why python is slow?\"),\", we discussed that the problems with \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://santhalakshminarayana.github.io/blog/super-fast-python-why-python-slow#gil-good-and-bad\"}),\"Global Interpreter Lock (GIL) in Python\"),\". \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://realpython.com/python-gil/\"}),\"GIL\"),\" is part of Python's design that ensures thread-safe in Python. But, GIL only allows the interpreter to run with only one thread which makes multi-threading hard and slow in Python.\"),mdx(\"p\",null,\"This makes multi-threading confined to use in cases like where \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://tenthousandmeters.com/blog/python-behind-the-scenes-13-the-gil-and-its-effects-on-python-multithreading/\"}),\"system releases the GIL\"),\" for tasks where it waits for external processes to complete and return result/status like I/O operations, network requests, etc. To achieve better concurrency in Python, use \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/asyncio-task.html\"}),\"coroutines with asyncio\"),\".\"),mdx(\"p\",null,\"So, even if the system has multiple cores and supports 1000s of threads, multi-threading is not suitable for CPU-intensive tasks. But, how to do \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://hpc.llnl.gov/documentation/tutorials/introduction-parallel-computing-tutorial\"}),\"parallel computing\"),\" in Python? The answer is Multi-programming. Multi-programming creates multiple sub-processes (maximum processes can be created = no.of cores) where each process will have its interpreter with GIL and independent memory space. In processes, GIL won't be a problem because each one will have its interpreter to run the bytecode and the CPython manages multiple sub-processes. But, there are some overheads with processes like spawning/forking a process with its own memory space is slower than creating a thread and each process is separate which makes inter-process communication slow.\"),mdx(\"p\",null,\"Also, there are external libraries like Numpy that release GIL and compute the tasks faster. \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://iotespresso.com/numpy-releases-gil-what-does-that-mean/\"}),\"Numpy releases GIL\"),\" - means most of the Numpy computations are executed in C-libraries that don't require an interpreter which makes Numpy can release the GIL for that particular C-library.\"),mdx(\"hr\",null),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/multiprocessing.html\"}),\"multiprocessing\"),\" module in Python offers a variety of APIs for achieving multiprocessing. In this blog, we discuss \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/multiprocessing.html#multiprocessing.pool.Pool\"}),\"mulitprocessing.Pool\"),\" class that takes multiple numbers of tasks and executes them parallelly by distributing tasks among multiple cores/workers.\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor\"}),\"concurrent.futures.ProcessPoolExecutor\"),\" provides a higher level interface on top of \",mdx(\"strong\",{parentName:\"p\"},\"multiprocessing\"),\" and offers additonal functions to control the process pool.\")),mdx(\"h2\",null,\"Multiprocessing Pool\"),mdx(\"h3\",null,\"Why and what is a pool?\"),mdx(\"p\",null,\"Imagine we have an 8-cores CPU and create a process by allocating each process to each core for every task and executing them parallelly. If no.of tasks is \u003c= no.of cores, then the parallel computing works smoothly. If we increase the no.of tasks to let's say 100 and create a process for each task and then execute them parallelly, the system has to manage the lifecycle of each process and ensure that processes don't hang up or reach a deadlock state. If we have numerous processes that the system can't handle we run into problems like system crash or hang.\"),mdx(\"p\",null,\"A pool is like a strategy in parallel computing to make sure that only a certain number of workers (or cores in the CPU) are allocated to run tasks given in any number. A pool is really helpful to prevent the system from the crash while serving a very huge number of processes that may overkill the CPU if not properly managed. We create a maximum of n-workers for a system with n-cores and distribute the task to every worker to run parallelly. The main difference is that in normal execution, for every task we create a separate process, but in pool processing, first, we create a pool of processes, then distribute the tasks among the processes in the pool.\"),mdx(\"p\",null,\"If we have 100 tasks and a pool with 5 processes, distribute the 100 tasks to the process pool by running a batch of 20 tasks per process.\"),mdx(\"p\",null,\"Consider a function that takes around \",mdx(\"strong\",{parentName:\"p\"},\"1-second\"),\" to complete. And we have to call the function for 10 different input parameters.\"),mdx(\"p\",null,\"The following example shows \",mdx(\"strong\",{parentName:\"p\"},\"fun_1()\"),\" as a function that takes a parameter \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\", sleeps for 1 second, and then returns the square of \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\".\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"Why prefer \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://peps.python.org/pep-0418/\"}),\"time.perf_counter()\"),\" over time.time()? time.time() is not monotonic - which means that the system can change the clock time with synchronization to the internet or other update. Where time.perf_counter() is system-wide and the reference point is unknown so only the results between consecutive calls are considered.\")),mdx(\"p\",null,\"Now, call the function 10 times by passing the elements in the range(0..10). If we call the function without parallel processing, the total time will be around 10 seconds because every function call takes 1 second, and for 10 function calls it will be around 10 seconds.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),`from os import getpid\nfrom time import perf_counter, sleep\nfrom multiprocessing import Pool, cpu_count\n\n# function that sleeps for 1 second\ndef fun_1(a):\n    print('WORKER ID:', getpid())\n    sleep(1)\n    return a * a\n\n# call fun_1 for elements in range(0..10)\n\n# without multiprocessing\natime = perf_counter()\nprint('without multiprocessing')\n\nres = [fun_1(i) for i in range(10)]\n\nprint(f\"time taken without multiprocessing: {perf_counter()-atime}\\\\n\")\n\n# with multiprocessing\natime = perf_counter()\nprint('with multiprocessing')\n\nwith Pool(processes=cpu_count()) as pool:\n    res = pool.map(fun_1, range(10))\n\nprint(f\"time taken with multiprocessing: {perf_counter()-atime}\")\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-markdown:output\"}),`without multiprocessing\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\nWORKER ID: 32093\ntime taken without multiprocessing: 10.019481873001496\n\nwith multiprocessing\nWORKER ID: 33097\nWORKER ID: 33099\nWORKER ID: 33098\nWORKER ID: 33100\nWORKER ID: 33101\nWORKER ID: 33103\nWORKER ID: 33102\nWORKER ID: 33096\nWORKER ID: 33098\nWORKER ID: 33101\ntime taken with multiprocessing: 2.077159455002402\n`)),mdx(\"p\",null,\"In the above code, we applied parallel computing by passing tasks (calling \",mdx(\"strong\",{parentName:\"p\"},\"fun\",\"_\",\"()\"),\") to the multiprocessing pool.\"),mdx(\"p\",null,\"The pool class constructor takes the following arguments and returns the pool object\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"processes\"),\": no.of workers, default is all cores available in the system. We can check the available cores by calling \",mdx(\"em\",{parentName:\"li\"},\"multiprocessing.cpu_count()\"),\" (mine is 8)\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"initializer\"),\": initializer function that will be called by every worker when it starts\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"initargs\"),\": arguments to the initializer function above\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"maxtasksperchild\"),\": max. no.of tasks a worker should execute before being replaced by another worker process. This behavior releases the workers that are using system resources for a very long time\")),mdx(\"p\",null,\"We discuss \",mdx(\"strong\",{parentName:\"p\"},\"initializer\"),\" and \",mdx(\"strong\",{parentName:\"p\"},\"initargs\"),\" in the later section on sharing data between processes.\"),mdx(\"p\",null,\"The pool object has several methods like apply, map, starmap, imap, etc, that serves different purpose for applying parallel computing. In the above snippet, we used Pool.map() function (same as normal map()) that takes a function and an iterable and calls the function by passing each element in the iterable as an argument. The function should accept only an argument. The Pool.map() is a blocking call and it distributes the tasks among the available cores by dividing the tasks into chunks.\"),mdx(\"p\",null,\"Pool.map() takes the following arguments\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"func\"),\": the function to be executed parallelly that takes one argument\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"iterable\"),\": an iterable whose elements are passed as arguments to the function above\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"chunksize\"),\": chunk size number that used to divide the tasks\")),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"based on the nature of tasks, different \",mdx(\"strong\",{parentName:\"p\"},\"chunksize\"),\" numbers \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://stackoverflow.com/questions/53751050/multiprocessing-understanding-logic-behind-chunksize\"}),\"schedules tasks differently\"))),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"In UNIX and such systems, \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/multiprocessing.html#contexts-and-start-methods\"}),\"multiprocessing creates processes\"),\" using a fork, and in windows, it starts processes using spawn. There are some \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/multiprocessing.html#contexts-and-start-methods\"}),\"additional restrictions\"),\" one should be aware of when the process start method is other than fork like protecting the entry point of the program by creating processes inside _if \",\"_\",\"_\",\"name\",\"_\",\"_\",\"==\",\"_\",\"_\",\"main\",\"_\",\"_\",\"_ because spawn creates new python interpreter for each process.\")),mdx(\"p\",null,\"As we have 8 cores available and 10 tasks at hand, Pool.map() distributes the tasks among the 8 workers by dividing tasks into chunks like \",\"[2, 2, 1, 1, 1, 1, 1, 1]\",\" and pass them to workers.\"),mdx(\"p\",null,\"The total time taken with multiprocessing is 2 seconds which is 5x times faster than without multiprocessing (10 seconds).\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"for large iterable size use Pool.imap() with chunksize for better efficiency\")),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"for multiple parameters function, use Pool.starmap() or Pool.map() with partial functions\")),mdx(\"h3\",null,\"Process vs Pool\"),mdx(\"p\",null,\"Use process, when there is a small number of tasks and each task takes a large amount of time. Use a pool, when there is a large number of tasks and each task takes a small amount of time.\"),mdx(\"hr\",null),mdx(\"h2\",null,\"Sharing data between processes\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"It is strongly recommended to not share data between processes\")),mdx(\"h3\",null,\"Share data with global variables (copy-on-write)\"),mdx(\"p\",null,\"Processes created using multiprocessing run independently with their own memory space and they don't have access to the parent process's local data but they \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://superfastpython.com/multiprocessing-inherit-global-variables-in-python/\"}),\"inherit the global data of the parent\"),\" (only when fork start method used).\"),mdx(\"p\",null,\"Since child processes get a snapshot of the parent process's global data, we can utilize this behavior in a way such that we can make sharable data available to child processes by making the data global.\"),mdx(\"p\",null,\"For the following example, we will share an integer value \",mdx(\"strong\",{parentName:\"p\"},\"x\"),\" and an array of integers \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\" to calculate the sum of the product of each element in \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\" with an element in the list of numbers from 0..n, n = 100000. And then compute the product of \",mdx(\"strong\",{parentName:\"p\"},\"x\"),\" and the whole sum.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),`# function to be applied for each element\ndef sum_product(e):\n    w_sum = sum([x*i for i in a])\n    return w_sum * e\n\n# pool initializer function\ndef pool_initializer(X, A):\n    global x\n    x = X\n    global a\n    a = A\n\nn = 100000\nX = 3\nA = [2, 4, 6, 8, 10, 12]\n\nwith Pool(processes=cpu_count(), initializer=pool_initializer, initargs=(X, A)) as pool:\n    res = pool.map(sum_product, range(n))\n`)),mdx(\"p\",null,\"In the above snippet, we initialized the pool with the \",mdx(\"em\",{parentName:\"p\"},\"pool_initializer\"),\" function, this function will be called for every worker after they start and any data globalized inside this initialization function is available to all child processes.\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"Even though we don't need the initializer function here to share data as we can make data global at the top level and all child processes would get a snapshot of the global data, there are other cases where the initializer function is useful. Like reading a file and sharing data, making a database connection, etc, which might work on variable parameters that we can pass in pool \",mdx(\"strong\",{parentName:\"p\"},\"initargs\"),\".\")),mdx(\"p\",null,\"Sharing data by leveraging global variables and copy-on-write data is only useful for read-only data. If any child process changes the global variable value, they don't reflect in the parent process.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),`from random import randint\n\ndef random_increment(i):\n    rand_n = randint(0, i)\n    a[rand_n] += 1\n    print(f'child {i}: {a}')\n\nn = 10\na = list(range(n))\n\nwith Pool(processes=cpu_count()) as pool:\n    pool.map(random_increment, range(n))\n\nprint(f'parent {a}')\n`)),mdx(\"p\",null,\"In the above program, we have initialized a global variable \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\" which is a list. We applied the function \",mdx(\"em\",{parentName:\"p\"},\"random_increment()\"),\" for \",mdx(\"strong\",{parentName:\"p\"},\"n\"),\" tasks, and, \",mdx(\"em\",{parentName:\"p\"},\"random_increment()\"),\" function takes the number \",mdx(\"strong\",{parentName:\"p\"},\"i\"),\" and increments the list \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\" at the index generated randomly in the range(0..i).\"),mdx(\"p\",null,\"As \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\" is global, we expect the list \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\" change in the parent process too, but it is not true as each child process is created by copying a snapshot of the parent data and each child will have their own memory.\"),mdx(\"p\",null,\"Look at the output of the above program below to check that, in the parent process, the value of \",mdx(\"strong\",{parentName:\"p\"},\"a\"),\" has not changed.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-markdown:Output\"}),`child 2: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 1: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 3: [0, 2, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 8: [1, 1, 3, 3, 4, 5, 6, 7, 8, 9]\nchild 7: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 6: [0, 1, 2, 3, 5, 5, 6, 7, 8, 9]\nchild 0: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 4: [0, 2, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 9: [1, 2, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 5: [0, 1, 2, 4, 4, 5, 6, 7, 8, 9]\nparent [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]\n`)),mdx(\"p\",null,\"This is because, the data sharing happens here by following a mechanism called \",mdx(\"strong\",{parentName:\"p\"},\"copy-on-write\"),\" where the OS instead of copying and creating the new memory for the global data, just facilitates access to the parent processes memory as long as the child process doesn't change the data. As we have seen in the above example, when the child process tries to change the data, OS just allocates the new memory by copying the shared data and then writes the changes to it. So, the child's process data changes are not reflected in the parent's process because both memory locations are different. This mechanism is vice-versa means that, after forking, when the data in the parent's process changes, they are not reflected in the child's process.\"),mdx(\"h3\",null,\"Share data using shared memory\"),mdx(\"p\",null,\"To avoid the problems like above, \",mdx(\"strong\",{parentName:\"p\"},\"multiprocessing\"),\" provides a mechanism to share data. To share the data between child processes, one must use sockets or shared files. But, to share simple values or arrays, multiprocessing provides a mechanism called \",mdx(\"strong\",{parentName:\"p\"},\"shared ctypes\"),\" to share data safely between processes.\"),mdx(\"p\",null,\"With \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/multiprocessing.html#module-multiprocessing.sharedctypes\"}),\"multiprocessing.sharedctypes\"),\", we can allocate the \",mdx(\"strong\",{parentName:\"p\"},\"ctypes\"),\" object from the shared memory and then the child processes can inherit them. \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/ctypes.html#fundamental-data-types\"}),\"cytpes\"),\" are nothing but primitive \",mdx(\"strong\",{parentName:\"p\"},\"C\"),\" compatible data types and \",mdx(\"strong\",{parentName:\"p\"},\"ctypes\"),\" module provides a wrapper around these data types to use in Python. The shared memory here is nothing but the underlying memory buffer and we will discuss later how can utilize this fact to share large Numpy arrays.\"),mdx(\"p\",null,\"Multiprocessing provides two types of shared ctypes, one for read-and-write values and arrays, and the other one for read-only values and arrays.\"),mdx(\"p\",null,\"To manipulate data in child processes, use\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"multiprocessing.Value\"),\": to share only single value variables such as numbers or strings\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"multiprocessing.Array\"),\": to share an array of values of the same data type in \",mdx(\"strong\",{parentName:\"li\"},\"C\"))),mdx(\"p\",null,\"To share read-only data, use\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"multiprocessing.RawValue\"),\": to share only single value variables\"),mdx(\"li\",{parentName:\"ul\"},mdx(\"strong\",{parentName:\"li\"},\"multiprocessing.RawArray\"),\": to share array of values\")),mdx(\"p\",null,\"The main difference between raw type and normal type is that the latter provides an automatic synchronization mechanism with locks to provide process-safe data sharing.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),`from multiprocessing import Array\n\ndef random_increment(i):\n    rand_n = randint(0, i)\n    a[rand_n] += 1\n\n    print(f'child {i}: {list(a)}')\n\ndef initializer_func(A):\n    global a\n    a = A\n\nn = 10\nA = Array('i', range(n))\n\nwith Pool(processes=cpu_count(), initializer=initializer_func, initargs=(A,)) as pool:\n    pool.map(random_increment, range(n))\n\nprint(f'parent: {list(A)}')\n`)),mdx(\"p\",null,\"In the above code, we have passed \",mdx(\"strong\",{parentName:\"p\"},\"multiprocessing.Array\"),\" instead of the normal list. \",mdx(\"strong\",{parentName:\"p\"},\"Array\"),\" is initialized with the data type ('i') and the iterable. We can also initialize the \",mdx(\"strong\",{parentName:\"p\"},\"Array\"),\" in other ways like defining the size first and assign later.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),`A = Array('i', 10)\nA = range(10)\n`)),mdx(\"p\",null,\"With \",mdx(\"strong\",{parentName:\"p\"},\"Array\"),\", we can now see that the global variable \",mdx(\"strong\",{parentName:\"p\"},\"A\"),\" is updated and reflected in the parent process. Also with \",mdx(\"strong\",{parentName:\"p\"},\"Array\"),\", we can get automatic synchronization with locks that manage by multiprocessing so that the shared data is process-safe and only one process can access the data.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-markdown:Output\"}),`child 3: [2, 1, 3, 4, 4, 5, 6, 7, 8, 9]\nchild 7: [2, 1, 3, 5, 5, 7, 6, 7, 8, 9]\nchild 5: [2, 1, 3, 5, 5, 5, 6, 7, 8, 9]\nchild 2: [2, 1, 3, 3, 4, 5, 6, 7, 8, 9]\nchild 0: [1, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 1: [2, 1, 2, 3, 4, 5, 6, 7, 8, 9]\nchild 4: [2, 1, 3, 5, 4, 5, 6, 7, 8, 9]\nchild 8: [2, 1, 3, 5, 5, 8, 6, 7, 8, 9]\nchild 9: [2, 1, 3, 5, 5, 8, 6, 8, 8, 9]\nchild 6: [2, 1, 3, 5, 5, 6, 6, 7, 8, 9]\nparent: [2, 1, 3, 5, 5, 8, 6, 8, 8, 9]\n`)),mdx(\"hr\",null),mdx(\"h2\",null,\"Share large Numpy arrays between child processes\"),mdx(\"p\",null,\"For each task, as we pass data as arguments to the processes, the data will be pickled so that it can be sent from one process to other. If we pass large amounts of data, pickling involves a huge amount of memory and consumes more time. So, it is better to \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://research.wmz.ninja/articles/2018/03/on-sharing-large-arrays-when-using-pythons-multiprocessing.html\"}),\"share large data between child processes\"),\" instead of passing the data individually.\"),mdx(\"p\",null,\"As we have seen in the above approach that copy-on-write sharing is good for read-only and to work with data that changes inside the child process, we have to share the data using a shared array. In this section, we will discuss sharing large Numpy arrays using a shared array.\"),mdx(\"p\",null,\"We know that shared arrays only support primitive \",mdx(\"strong\",{parentName:\"p\"},\"C\"),\" data types and mainly 1D objects. But, how to share the Numpy arrays which are multidimensional in general to the child processes as shared ctypes do not directly support Numpy arrays? We can share Numpy arrays with some work around that is explained below.\"),mdx(\"p\",null,\"The shared ctypes objects we get are allocated from \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/c-api/buffer.html\"}),\"buffer memory\"),\" memory. A \",mdx(\"a\",e({parentName:\"p\"},{href:\"http://jakevdp.github.io/blog/2014/05/05/introduction-to-the-python-buffer-protocol/\"}),\"buffer protocol\"),\" is a framework in Python designed to provide a mechanism for Python objects to share their data among objects. Any Python objects that are implemented in C-APIs can export a set of functions called the \",mdx(\"strong\",{parentName:\"p\"},\"buffer interface\"),\". With this buffer interface, \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://towardsdatascience.com/loading-binary-data-to-numpy-pandas-9caa03eb0672\"}),\"any object can expose its data to other objects\"),\" directly without the need for copying.\"),mdx(\"p\",null,\"As shared ctypes objects are just wrappers around the C data types whose memory was allocated from buffer memory. This is the reason why the child process's changes reflect in the parent process because the shared memory passed to child processes are implemented as \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://docs.python.org/3/library/stdtypes.html#memoryview\"}),\"memoryview\"),\" objects.\"),mdx(\"p\",null,\"Consider the following example where we first create a large Numpy array of shape (1000, 1000), and using the process pool we assign the row number to every element in that row. As shared array doesn't support multidimensional and custom data types, a common approach is to pass the Numpy array to every worker and assign the row with a row number. But, passing the large arrays between processes take huge memory and latency. So, we utilize the buffer protocol here. Since shared array objects are provided with a buffer interface, we can rely on this shared memory and make it global so that there is no need to pass Numpy arrays as arguments to each process.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-python\"}),`def assign_int(i):\n    arr = np.frombuffer(np_x.get_obj(), dtype=np.int32).reshape(np_x_shape)\n    arr[i, :] = i\n\ndef pool_initializer(X, X_shape):\n    global np_x\n    np_x = X\n    global np_x_shape\n    np_x_shape = X_shape\n\nX_shape = (1000, 1000)\ndata = np.zeros(X_shape, dtype=np.int32)\nX = Array('i', X_shape[0] * X_shape[1])\n# X as a Numpy array\nX_np = np.frombuffer(X.get_obj(), dtype=np.int32).reshape(X_shape)\n# copy data to the shared array\nnp.copyto(X_np, data)\n\nwith Pool(processes=cpu_count(), initializer=pool_initializer, initargs=(X, X_shape)) as pool:\n    pool.map(assign_int, range(X_shape[0]))\n\nprint(f'Numpy array X_np:\\\\n{X_np}')\n`)),mdx(\"p\",null,\"First, we defined the shape of the array \",mdx(\"strong\",{parentName:\"p\"},\"X_Shape\"),\", and then created a Numpy array with zeros of shape \",mdx(\"strong\",{parentName:\"p\"},\"X_Shape\"),\". Second, we have created a synchronized shared array and assigned it to \",mdx(\"strong\",{parentName:\"p\"},\"X\"),\". Third, we wrapped the shared array as Numpy using \",mdx(\"strong\",{parentName:\"p\"},\"np.frombuffer\"),\".\"),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},\"np.frombuffer\"),\" takes a 1-dimensional buffer array and interprets it into a Numpy array so we can manipulate the array easily. We used \",mdx(\"em\",{parentName:\"p\"},\"X.get_obj()\"),\" instead \",mdx(\"strong\",{parentName:\"p\"},\"X\"),\" because \",mdx(\"strong\",{parentName:\"p\"},\"X\"),\" is a synchronized wrapper around the raw array and calling the \",mdx(\"strong\",{parentName:\"p\"},\"get_obj()\"),\" returns the raw buffer object.\"),mdx(\"blockquote\",null,mdx(\"p\",{parentName:\"blockquote\"},\"For raw arrays (RawArray), objects should be passed normally without calling get_obj().\")),mdx(\"p\",null,\"Why use \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://www.educba.com/numpy-frombuffer/\"}),mdx(\"strong\",{parentName:\"a\"},\"np.frombuffer\")),\"? Since Numpy arrays take a large amount of memory space, we don't want to create a copy that again takes large memory. So, using \",mdx(\"strong\",{parentName:\"p\"},\"np.frombuffer\"),\" by utilizing the buffer protocol, we can get a Numpy array which is just a wrapper around the buffer memory.\"),mdx(\"p\",null,\"In \",mdx(\"strong\",{parentName:\"p\"},\"initiargs\"),\", we should pass the shared array instead Numpy wrapper. We also pass the shape of the Numpy array as we need to reshape the 1D shared array into a multidimensional array in the worker function \",mdx(\"em\",{parentName:\"p\"},\"assign_int()\"),\".\"),mdx(\"p\",null,\"In the worker function \",mdx(\"em\",{parentName:\"p\"},\"assign_int()\"),\", again we interpreted the buffer as a Numpy array and assigned the row values at row number \",mdx(\"strong\",{parentName:\"p\"},\"i\"),\".\"),mdx(\"p\",null,\"At last, in the parent process, we can check the multiprocessing assignment of the Numpy array.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-markdown:Output\"}),`Numpy array X_np:\n[[  0   0   0 ...   0   0   0]\n [  1   1   1 ...   1   1   1]\n [  2   2   2 ...   2   2   2]\n ...\n [997 997 997 ... 997 997 997]\n [998 998 998 ... 998 998 998]\n [999 999 999 ... 999 999 999]]\n`)),mdx(\"hr\",null),mdx(\"p\",null,\"Even though \",mdx(\"strong\",{parentName:\"p\"},\"multiprocessing\"),\" looks easy and flexible to use, there are some issues one can face with \",mdx(\"strong\",{parentName:\"p\"},\"multiprocessing\"),\" if not careful,\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://pythonspeed.com/articles/python-multiprocessing/\"}),\"Why your multiprocessing Pool is stuck\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://superfastpython.com/multiprocessing-best-practices/\"}),\"Multiprocessing Best Practices\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://sefiks.com/2021/07/05/handling-hang-in-python-multiprocessing/\"}),\"Handling Hang in Python Multiprocessing\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://pythonspeed.com/articles/parallelism-slower/\"}),\"The Parallelism Blues: when faster code is slower\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.cloudcity.io/blog/2019/02/27/things-i-wish-they-told-me-about-multiprocessing-in-python/\"}),\"Things I Wish They Told Me About Multiprocessing in Python\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://towardsdatascience.com/exception-handling-in-methods-of-the-multiprocessing-pool-class-in-python-7fbb73746c26\"}),\"Exception Handling in Methods of the Multiprocessing Pool Class in Python\"))),mdx(\"p\",null,\"In this blog, we discussed Python's \",mdx(\"strong\",{parentName:\"p\"},\"multiprocessing\"),\" module with the Pool function. Python released other modules for simple concurrent processing and better data sharing,\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.python.org/3/library/multiprocessing.html#managers\"}),\"Managers\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.python.org/3/library/multiprocessing.shared_memory.html\"}),\"Shared Memroy\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.python.org/3/library/concurrent.futures.html\"}),\"Concurrent Futures\"))),mdx(\"p\",null,\"On top of internal libraries, there are multiple good external libraries available for parallel and concurrent processing,\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://joblib.readthedocs.io/en/latest/parallel.html\"}),\"Joblib\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://ipyparallel.readthedocs.io/en/latest/tutorial/intro.html\"}),\"IPyParallel\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://docs.ray.io/en/master/index.html\"}),\"Ray\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.dask.org/\"}),\"Dask\"))),mdx(\"p\",null,\"For comparison among internal and external libraries,\"),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://www.anyscale.com/blog/parallelizing-python-code\"}),\"Parallelizing Python Code\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://cosmiccoding.com.au/tutorials/multiprocessing\"}),\"Multiprocessing In Python: Core vs libraries\")),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",e({parentName:\"li\"},{href:\"https://luis-sena.medium.com/sharing-big-numpy-arrays-across-python-processes-abf0dc2a0ab2\"}),\"Sharing big NumPy arrays across python processes\"))))}MDXContent.isMDXComponent=!0;\n","scope":{}},"id":"super-fast-python-multi-processing"},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"super-fast-python-multi-processing"},"buildId":"9jpMCygIQS262thMs5TvH","runtimeConfig":{},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>